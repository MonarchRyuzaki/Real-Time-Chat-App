// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  username        String            @id
  password        String
  friendships1    Friendship[]      @relation("User1Friendship")
  friendships2    Friendship[]      @relation("User2Friendship")
  groupMembership GroupMembership[]
  createdGroups   Group[]           @relation("GroupCreator")
  OfflineMessages OfflineMessages[]
}

model Friendship {
  chatId   String @id
  user1    String
  user2    String
  user1Rel User   @relation("User1Friendship", fields: [user1], references: [username])
  user2Rel User   @relation("User2Friendship", fields: [user2], references: [username])

  @@unique([user1, user2])
}

model Group {
  groupId   String            @id
  groupName String
  createdBy String
  creator   User              @relation("GroupCreator", fields: [createdBy], references: [username])
  members   GroupMembership[]
}

model GroupMembership {
  id       Int    @id @default(autoincrement())
  user     String
  userRel  User   @relation(fields: [user], references: [username])
  group    String
  groupRel Group  @relation(fields: [group], references: [groupId])

  @@unique([user, group])
}

model OfflineMessages {
  username     String
  messageId    String
  partitionKey String
  messageType  MessageType
  user         User        @relation(fields: [username], references: [username])

  @@id([username, messageId])
}

enum MessageType {
  ONE_TO_ONE
  GROUP
}
